"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.deleteMessage = deleteMessage;
const n8n_workflow_1 = require("n8n-workflow");
const evolutionRequest_1 = require("../evolutionRequest");
async function deleteMessage(ef) {
    try {
        const instanceName = ef.getNodeParameter('instanceName', 0);
        const remoteJid = ef.getNodeParameter('remoteJid', 0);
        const messageId = ef.getNodeParameter('messageId', 0);
        const fromMe = ef.getNodeParameter('fromMe', 0);
        const formattedRemoteJid = remoteJid.includes('@g.us') || remoteJid.includes('@s.whatsapp.net')
            ? remoteJid
            : `${remoteJid}@s.whatsapp.net`;
        const body = {
            id: messageId,
            fromMe,
            remoteJid: formattedRemoteJid,
        };
        if (!fromMe) {
            const participant = ef.getNodeParameter('participant', 0);
            body.participant = participant.includes('@s.whatsapp.net')
                ? participant
                : `${participant}@s.whatsapp.net`;
        }
        const requestOptions = {
            method: 'DELETE',
            uri: `/chat/deleteMessageForEveryone/${instanceName}`,
            body,
            json: true,
        };
        const response = await (0, evolutionRequest_1.evolutionRequest)(ef, requestOptions);
        return {
            json: {
                success: true,
                data: response,
            },
        };
    }
    catch (error) {
        const errorData = {
            success: false,
            error: {
                message: error.message,
                details: 'Erro ao deletar mensagem',
                code: error.code || 'UNKNOWN_ERROR',
                timestamp: new Date().toISOString(),
            },
        };
        if (!ef.continueOnFail()) {
            throw new n8n_workflow_1.NodeOperationError(ef.getNode(), error.message, {
                message: errorData.error.message,
                description: errorData.error.details,
            });
        }
        return {
            json: errorData,
            error: errorData,
        };
    }
}
//# sourceMappingURL=deleteMessage.js.map